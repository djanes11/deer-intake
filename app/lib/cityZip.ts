// app/lib/cityZip.ts
export type StateCode = string;

export function normalizeCity(input: string | undefined | null): string {
  return String(input || "")
    .trim()
    .toUpperCase()
    .replace(/\./g, "")
    .replace(/\s+/g, " ");
}

// Conservative 1:1 cityâ†’ZIP map for IN/KY.
// Only list cities that have a single USPS ZIP.
// If a place has multiple ZIPs, do NOT include it here.
export const CITY_ZIPS: Record<string, Record<string, string[]>> = {
  IN: {
    "AKRON": ["46910"],
    "ALBANY": ["47320"],
    "ALEXANDRIA": ["46001"],
    "ANDREWS": ["46702"],
    "ANGOLA": ["46703"],
    "ARCADIA": ["46030"],
    "ARGOS": ["46501"],
    "ARLINGTON": ["46104"],
    "ATLANTA": ["46031"],
    "ATTICA": ["47918"],
    "AURORA": ["47001"],
    "AVILLA": ["46710"],
    "BAINBRIDGE": ["46105"],
    "BATESVILLE": ["47006"],
    "BATTLE GROUND": ["47920"],
    "BEDFORD": ["47421"],
    "BERNE": ["46711"],
    "BETHANY": ["46158"],           // Mooresville routing
    "BICKNELL": ["47512"],
    "BIRDSEYE": ["47513"],
    "BLUFFTON": ["46714"],
    "BOURBON": ["46504"],
    "BRAZIL": ["47834"],
    "BROOK": ["47922"],
    "BROOKSTON": ["47923"],
    "BROOKVILLE": ["47012"],
    "BROWNSTOWN": ["47220"],
    "BUTLER": ["46721"],
    "CAMBY": ["46113"],
    "CARLISLE": ["47838"],
    "CARTHAGE": ["46115"],
    "CAYUGA": ["47928"],
    "CEDAR LAKE": ["46303"],
    "CENTERPOINT": ["47840"],
    "CENTERVILLE": ["47330"],
    "CHALMERS": ["47929"],
    "CHANDLER": ["47610"],
    "CHARLESTOWN": ["47111"],
    "CHESTERTON": ["46304"],
    "CHURUBUSCO": ["46723"],
    "CLAY CITY": ["47841"],
    "CLAYPOOL": ["46510"],
    "CLAYTON": ["46118"],
    "CLIFFORD": ["47226"],
    "CLOVERDALE": ["46120"],
    "COAL CITY": ["47427"],
    "COLFAX": ["46035"],
    "COLUMBIA CITY": ["46725"],
    "CONNERSVILLE": ["47331"],
    "CORYDON": ["47112"],
    "CORUNNA": ["46730"],
    "COVINGTON": ["47932"],
    "CRAIGVILLE": ["46731"],
    "CRANE": ["47522"],
    "CROMWELL": ["46732"],
    "CULVER": ["46511"],
    "CUTLER": ["46920"],
    "DALEVILLE": ["47334"],
    "DANVILLE": ["46122"],
    "DARLINGTON": ["47940"],
    "DAYTON": ["47941"],
    "DECKER": ["47524"],
    "DELPHI": ["46923"],
    "DEMOTTE": ["46310"],
    "DILLSBORO": ["47018"],
    "DUBLIN": ["47335"],
    "DUBOIS": ["47527"],
    "DUNREITH": ["47337"],
    "EATON": ["47338"],
    "EDINBURGH": ["46124"],
    "ELBERFELD": ["47613"],
    "ELIZABETH": ["47117"],
    "ELNORA": ["47529"],
    "ELWOOD": ["46036"],
    "ENGLISH": ["47118"],
    "ETNA GREEN": ["46524"],
    "FAIRMOUNT": ["46928"],
    "FAIRLAND": ["46126"],
    "FARMERSBURG": ["47850"],
    "FLORA": ["46929"],
    "FORTVILLE": ["46040"],
    "FOUNTAINTOWN": ["46130"],
    "FRANCISCO": ["47649"],
    "FRANKTON": ["46044"],
    "FRIENDSHIP": ["47021"],
    "FULTON": ["46931"],
    "GAS CITY": ["46933"],
    "GOODLAND": ["47948"],
    "GRABILL": ["46741"],
    "GRANDVIEW": ["47615"],
    "GREENTOWN": ["46936"],
    "GRIFFITH": ["46319"],
    "HAGERSTOWN": ["47346"],
    "HAMILTON": ["46742"],
    "HARMONY": ["47853"],
    "HARTFORD CITY": ["47348"],
    "HAUBSTADT": ["47639"],
    "HEBRON": ["46341"],
    "HENRYVILLE": ["47126"],
    "HILLSBORO": ["47949"],
    "HOPE": ["47246"],
    "HUDSON": ["46747"],
    "HUNTERTOWN": ["46748"],
    "HUNTINGBURG": ["47542"],
    "JAMESTOWN": ["46147"],
    "JONESBORO": ["46938"],
    "KEMPTON": ["46049"],
    "KENTLAND": ["47951"],
    "KNIGHTSTOWN": ["46148"],
    "KNOX": ["46534"],
    "KOUTS": ["46347"],
    "LA CROSSE": ["46348"],
    "LAGRO": ["46941"],
    "LAGRANGE": ["46761"],
    "LAPEL": ["46051"],
    "LEO": ["46765"],
    "LEXINGTON": ["47138"],
    "LIBERTY": ["47353"],
    "LIGONIER": ["46767"],
    "LINDEN": ["47955"],
    "LIZTON": ["46149"],
    "LOGANSPORT": ["46947"],
    "LOOGOOTEE": ["47553"],
    "LOSANTVILLE": ["47354"],
    "LYNN": ["47355"],
    "LYNNVILLE": ["47619"],
    "MADISON": ["47250"],
    "MARKLE": ["46770"],
    "MARYSVILLE": ["47141"],
    "MATTHEWS": ["46957"],
    "MIDDLETOWN": ["47356"],
    "MILAN": ["47031"],
    "MILLERSBURG": ["46543"],
    "MILLTOWN": ["47145"],
    "MITCHELL": ["47446"],
    "MONROEVILLE": ["46773"],
    "MONROVIA": ["46157"],
    "MONTEREY": ["46960"],
    "MONTGOMERY": ["47558"],
    "MONTPELIER": ["47359"],
    "MOORES HILL": ["47032"],
    "MOORESVILLE": ["46158"],
    "MOROCCO": ["47963"],
    "MORRISTOWN": ["46161"],
    "MOUNT AYR": ["47964"],
    "MOUNT SUMMIT": ["47361"],
    "MULBERRY": ["46058"],
    "NAPPANEE": ["46550"],
    "NASHVILLE": ["47448"],
    "NEW PARIS": ["46553"],
    "NEW ROSS": ["47968"],
    "NEW WASHINGTON": ["47162"],
    "NEWBURGH": ["47630"],
    "NORTH JUDSON": ["46366"],
    "NORTH MANCHESTER": ["46962"],
    "NORTH SALEM": ["46165"],
    "OAKTOWN": ["47561"],
    "OOLITIC": ["47451"],
    "ORLAND": ["46776"],
    "ORLEANS": ["47452"],
    "OSSIAN": ["46777"],
    "OXFORD": ["47971"],
    "PALMYRA": ["47164"],
    "PARKER CITY": ["47368"],
    "PENDLETON": ["46064"],
    "PERU": ["46970"],
    "PITTSBORO": ["46167"],
    "PLAINFIELD": ["46168"],
    "PONETO": ["46781"],
    "PORTLAND": ["47371"],
    "REDKEY": ["47373"],
    "RENSSELAER": ["47978"],
    "RIDGEVILLE": ["47380"],
    "ROACHDALE": ["46172"],
    "ROCHESTER": ["46975"],
    "ROCKPORT": ["47635"],
    "ROCKVILLE": ["47872"],
    "ROME CITY": ["46784"],
    "ROSSVILLE": ["46065"],
    "ROYAL CENTER": ["46978"],
    "RUSHVILLE": ["46173"],
    "SAINT PAUL": ["47272"],
    "SALEM": ["47167"],
    "SANTA CLAUS": ["47579"],
    "SARATOGA": ["47382"],
    "SCOTTSBURG": ["47170"],
    "SEELYVILLE": ["47878"],
    "SELLERSBURG": ["47172"],
    "SHIRLEY": ["47384"],
    "SHOALS": ["47581"],
    "SOUTH WHITLEY": ["46787"],
    "SPENCER": ["47460"],
    "SPRINGPORT": ["47386"],
    "STILESVILLE": ["46180"],
    "STRAUGHN": ["47387"],
    "SULLIVAN": ["47882"],
    "SUMMITVILLE": ["46070"],
    "SWAYZEE": ["46986"],
    "SWEETSER": ["46987"],
    "SWITZ CITY": ["47465"],
    "SYRACUSE": ["46567"],
    "TELL CITY": ["47586"],
    "THORNTOWN": ["46071"],
    "TOPEKA": ["46571"],
    "TRAFALGAR": ["46181"],
    "UNION CITY": ["47390"],
    "UPLAND": ["46989"],
    "VEEDERSBURG": ["47987"],
    "VEVAY": ["47043"],
    "WABASH": ["46992"],
    "WALDRON": ["46182"],
    "WALKERTON": ["46574"],
    "WASHINGTON": ["47501"],
    "WATERLOO": ["46793"],
    "WESTPORT": ["47283"],
    "WHITELAND": ["46184"],
    "WILLIAMSPORT": ["47993"],
    "WOLCOTT": ["47995"],
    "WORTHINGTON": ["47471"],
    "YODER": ["46798"]
  },
  KY: {
    "ADAIRVILLE": ["42202"],
    "ALBANY": ["42602"],
    "ARLINGTON": ["42021"],
    "AUBURN": ["42206"],
    "BAGDAD": ["40003"],
    "BARDWELL": ["42023"],
    "BARLOW": ["42024"],
    "BEATTYVILLE": ["41311"],
    "BEAVER DAM": ["42320"],
    "BEE SPRING": ["42207"],
    "BENTON": ["42025"],
    "BOONEVILLE": ["41314"],
    "BRODHEAD": ["40409"],
    "BROOKSVILLE": ["41004"],
    "BROWNSVILLE": ["42210"],
    "BURKESVILLE": ["42717"],
    "BURNSIDE": ["42519"],
    "BUTLER": ["41006"],
    "CADIZ": ["42211"],
    "CALHOUN": ["42327"],
    "CALVERT CITY": ["42029"],
    "CAMPTON": ["41301"],
    "CANNEL CITY": ["41408"],
    "CARLISLE": ["40311"],
    "CARROLLTON": ["41008"],
    "CLAY CITY": ["40312"],
    "CLINTON": ["42031"],
    "CLOVERPORT": ["40111"],
    "COLUMBIA": ["42728"],
    "CORYDON": ["40119"],
    "CRITTENDEN": ["41030"],
    "CUMBERLAND": ["40823"],
    "CYNTHIANA": ["41031"],
    "DAWSON SPRINGS": ["42408"],
    "DIXON": ["42409"],
    "DRY RIDGE": ["41035"],
    "EDDYVILLE": ["42038"],
    "EMINENCE": ["40019"],
    "EUBANK": ["42567"],
    "FALMOUTH": ["41040"],
    "FANCY FARM": ["42039"],
    "FLEMINGSBURG": ["41041"],
    "FORT THOMAS": ["41075"],
    "FRENCHBURG": ["40322"],
    "GARRISON": ["41141"],
    "GEORGETOWN": ["40324"],
    "GLASGOW": ["42141"],
    "GRAYSON": ["41143"],
    "GREENSBURG": ["42743"],
    "GREENUP": ["41144"],
    "HARDINSBURG": ["40143"],
    "HARRODSBURG": ["40330"],
    "HAZARD": ["41701"],
    "HICKMAN": ["42050"],
    "HINDMAN": ["41822"],
    "HODGENVILLE": ["42748"],
    "HUSTONVILLE": ["40437"],
    "IRVINE": ["40336"],
    "JACKSON": ["41339"],
    "JAMESTOWN": ["42629"],
    "LANCASTER": ["40444"],
    "LAWRENCEBURG": ["40342"],
    "LEBANON": ["40033"],
    "LEITCHFIELD": ["42754"],
    "LEWISBURG": ["42256"],
    "LONDON": ["40741"],
    "LOUISA": ["41230"],
    "LOVELY": ["41231"],
    "MACKVILLE": ["40040"],
    "MADISONVILLE": ["42431"],
    "MARION": ["42064"],
    "MAYFIELD": ["42066"],
    "MCKEE": ["40447"],
    "MCKINNEY": ["40448"],
    "MONTICELLO": ["42633"],
    "MOREHEAD": ["40351"],
    "MORGANFIELD": ["42437"],
    "MOUNT STERLING": ["40353"],
    "MUNFORDVILLE": ["42765"],
    "NEBO": ["42441"],
    "NICHOLASVILLE": ["40356"],
    "OLIVE HILL": ["41164"],
    "OWINGSVILLE": ["40360"],
    "PAINTSVILLE": ["41240"],
    "PARIS": ["40361"],
    "PEMBROKE": ["42266"],
    "PERRYVILLE": ["40468"],
    "PINEVILLE": ["40977"],
    "PRINCETON": ["42445"],
    "PROVIDENCE": ["42450"],
    "RUSSELL SPRINGS": ["42642"],
    "SANDY HOOK": ["41171"],
    "SCIENCE HILL": ["42553"],
    "SHARON GROVE": ["42280"],
    "SHELBYVILLE": ["40065"],
    "SMITHLAND": ["42081"],
    "SMITHS GROVE": ["42171"],
    "STANFORD": ["40484"],
    "TAYLORSVILLE": ["40071"],
    "TOMPKINSVILLE": ["42167"],
    "VANCEBURG": ["41179"],
    "VARNEY": ["41571"],
    "WAVERLY": ["42462"],
    "WEST LIBERTY": ["41472"],
    "WHITLEY CITY": ["42653"],
    "WILLIAMSBURG": ["40769"],
    "WORTHVILLE": ["41098"]
  }
};

export function lookupUniqueZipByCity(
  state: StateCode | string | undefined,
  city: string | undefined | null
): string | null {
  const st = String(state || "").trim().toUpperCase();
  const c = normalizeCity(city);
  if (!st || !c) return null;
  const table = CITY_ZIPS[st];
  if (!table) return null;
  const zips = table[c];
  if (!zips || !Array.isArray(zips)) return null;
  return zips.length === 1 ? zips[0] : null;
}
