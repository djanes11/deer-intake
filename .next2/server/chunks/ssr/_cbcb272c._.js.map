{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alyssa%20Janes/Desktop/deer-intake/lib/useScanner.ts"],"sourcesContent":["'use client';\r\nimport { useEffect, useRef } from 'react';\r\n\r\n/**\r\n * useScanner - captures fast keyboard-wedge barcode scans that end with Enter.\r\n * Resets buffer if typing is slow (i.e., a human).\r\n */\r\nexport function useScanner(onScan: (code: string) => void, opts?: { resetMs?: number }) {\r\n  const buf = useRef('');\r\n  const t = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n  const resetMs = opts?.resetMs ?? 150;\r\n\r\n  useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === 'Enter') {\r\n        const code = buf.current.trim();\r\n        buf.current = '';\r\n        if (code) onScan(code);\r\n        return;\r\n      }\r\n      if (e.key.length === 1) {\r\n        buf.current += e.key;\r\n        if (t.current) clearTimeout(t.current);\r\n        t.current = setTimeout(() => (buf.current = ''), resetMs);\r\n      }\r\n    };\r\n    window.addEventListener('keydown', onKey);\r\n    return () => window.removeEventListener('keydown', onKey);\r\n  }, [onScan, resetMs]);\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AADA;;AAOO,SAAS,WAAW,MAA8B,EAAE,IAA2B;IACpF,MAAM,MAAM,IAAA,+MAAM,EAAC;IACnB,MAAM,IAAI,IAAA,+MAAM,EAAuC;IACvD,MAAM,UAAU,MAAM,WAAW;IAEjC,IAAA,kNAAS,EAAC;QACR,MAAM,QAAQ,CAAC;YACb,IAAI,EAAE,GAAG,KAAK,SAAS;gBACrB,MAAM,OAAO,IAAI,OAAO,CAAC,IAAI;gBAC7B,IAAI,OAAO,GAAG;gBACd,IAAI,MAAM,OAAO;gBACjB;YACF;YACA,IAAI,EAAE,GAAG,CAAC,MAAM,KAAK,GAAG;gBACtB,IAAI,OAAO,IAAI,EAAE,GAAG;gBACpB,IAAI,EAAE,OAAO,EAAE,aAAa,EAAE,OAAO;gBACrC,EAAE,OAAO,GAAG,WAAW,IAAO,IAAI,OAAO,GAAG,IAAK;YACnD;QACF;QACA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO,IAAM,OAAO,mBAAmB,CAAC,WAAW;IACrD,GAAG;QAAC;QAAQ;KAAQ;AACtB","debugId":null}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alyssa%20Janes/Desktop/deer-intake/lib/api.ts"],"sourcesContent":["const BASE = '/api/gas2';\r\n\r\nexport type GetJobResp = { ok: boolean; exists: boolean; job?: any; error?: string };\r\nexport type SaveResp   = { ok: boolean; error?: string; row?: number };\r\nexport type ProgressResp = { ok: boolean; nextStatus?: 'Processing'|'Finished'|null; error?: string };\r\nexport type SearchJobsResp = { ok: boolean; rows: any[]; total?: number; error?: string };\r\n\r\nasync function fetchJson(url: string, init?: RequestInit, attempts = 3, timeoutMs = 7000) {\r\n  let lastErr: any = null;\r\n  for (let i = 0; i < attempts; i++) {\r\n    const ctrl = new AbortController();\r\n    const to = setTimeout(() => ctrl.abort(), timeoutMs);\r\n    try {\r\n      const res = await fetch(url, { cache: 'no-store', ...init, signal: ctrl.signal });\r\n      clearTimeout(to);\r\n      const data = await res.json().catch(() => ({}));\r\n      if (res.ok) return data;\r\n      lastErr = data?.error || `HTTP ${res.status}`;\r\n      // retry on transient\r\n      if ([429, 502, 503, 504].includes(res.status)) { await new Promise(r => setTimeout(r, 250*(i+1))); continue; }\r\n      break;\r\n    } catch (e:any) {\r\n      clearTimeout(to);\r\n      lastErr = e?.name === 'AbortError' ? 'Request timed out' : (e?.message || e);\r\n      await new Promise(r => setTimeout(r, 250*(i+1)));\r\n    }\r\n  }\r\n  return { ok: false, error: String(lastErr || 'Network error') };\r\n}\r\n\r\nexport async function getJob(tag: string): Promise<GetJobResp> {\r\n  return fetchJson(`${BASE}/get?tag=${encodeURIComponent(tag)}`);\r\n}\r\n\r\nexport async function saveJob(job: any): Promise<SaveResp> {\r\n  return fetchJson(`${BASE}/save`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type':'application/json' },\r\n    body: JSON.stringify({ job })\r\n  });\r\n}\r\n\r\nexport async function progress(tag: string): Promise<ProgressResp> {\r\n  return fetchJson(`${BASE}/progress`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type':'application/json' },\r\n    body: JSON.stringify({ tag })\r\n  });\r\n}\r\n\r\nexport async function searchJobs(\r\n  opts?: string | { q?: string; status?: string; limit?: number; offset?: number }\r\n): Promise<SearchJobsResp> {\r\n  const o = typeof opts === 'string' ? { q: opts } : (opts || {});\r\n  const p = new URLSearchParams();\r\n  if (o.q) p.set('q', o.q);\r\n  if (o.status) p.set('status', o.status);\r\n  if (o.limit != null) p.set('limit', String(o.limit));\r\n  if (o.offset != null) p.set('offset', String(o.offset));\r\n  return fetchJson(`${BASE}/search?${p.toString()}`);\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,MAAM,OAAO;AAOb,eAAe,UAAU,GAAW,EAAE,IAAkB,EAAE,WAAW,CAAC,EAAE,YAAY,IAAI;IACtF,IAAI,UAAe;IACnB,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,IAAK;QACjC,MAAM,OAAO,IAAI;QACjB,MAAM,KAAK,WAAW,IAAM,KAAK,KAAK,IAAI;QAC1C,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,KAAK;gBAAE,OAAO;gBAAY,GAAG,IAAI;gBAAE,QAAQ,KAAK,MAAM;YAAC;YAC/E,aAAa;YACb,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YAC7C,IAAI,IAAI,EAAE,EAAE,OAAO;YACnB,UAAU,MAAM,SAAS,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;YAC7C,qBAAqB;YACrB,IAAI;gBAAC;gBAAK;gBAAK;gBAAK;aAAI,CAAC,QAAQ,CAAC,IAAI,MAAM,GAAG;gBAAE,MAAM,IAAI,QAAQ,CAAA,IAAK,WAAW,GAAG,MAAI,CAAC,IAAE,CAAC;gBAAK;YAAU;YAC7G;QACF,EAAE,OAAO,GAAO;YACd,aAAa;YACb,UAAU,GAAG,SAAS,eAAe,sBAAuB,GAAG,WAAW;YAC1E,MAAM,IAAI,QAAQ,CAAA,IAAK,WAAW,GAAG,MAAI,CAAC,IAAE,CAAC;QAC/C;IACF;IACA,OAAO;QAAE,IAAI;QAAO,OAAO,OAAO,WAAW;IAAiB;AAChE;AAEO,eAAe,OAAO,GAAW;IACtC,OAAO,UAAU,GAAG,KAAK,SAAS,EAAE,mBAAmB,MAAM;AAC/D;AAEO,eAAe,QAAQ,GAAQ;IACpC,OAAO,UAAU,GAAG,KAAK,KAAK,CAAC,EAAE;QAC/B,QAAQ;QACR,SAAS;YAAE,gBAAe;QAAmB;QAC7C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAI;IAC7B;AACF;AAEO,eAAe,SAAS,GAAW;IACxC,OAAO,UAAU,GAAG,KAAK,SAAS,CAAC,EAAE;QACnC,QAAQ;QACR,SAAS;YAAE,gBAAe;QAAmB;QAC7C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAI;IAC7B;AACF;AAEO,eAAe,WACpB,IAAgF;IAEhF,MAAM,IAAI,OAAO,SAAS,WAAW;QAAE,GAAG;IAAK,IAAK,QAAQ,CAAC;IAC7D,MAAM,IAAI,IAAI;IACd,IAAI,EAAE,CAAC,EAAE,EAAE,GAAG,CAAC,KAAK,EAAE,CAAC;IACvB,IAAI,EAAE,MAAM,EAAE,EAAE,GAAG,CAAC,UAAU,EAAE,MAAM;IACtC,IAAI,EAAE,KAAK,IAAI,MAAM,EAAE,GAAG,CAAC,SAAS,OAAO,EAAE,KAAK;IAClD,IAAI,EAAE,MAAM,IAAI,MAAM,EAAE,GAAG,CAAC,UAAU,OAAO,EAAE,MAAM;IACrD,OAAO,UAAU,GAAG,KAAK,QAAQ,EAAE,EAAE,QAAQ,IAAI;AACnD","debugId":null}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alyssa%20Janes/Desktop/deer-intake/app/scan/page.tsx"],"sourcesContent":["'use client';\r\nimport { useRef, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useScanner } from '@/lib/useScanner';\r\nimport { progress } from '@/lib/api';\r\n\r\nfunction useBeep() {\r\n  // Tiny WebAudio beeps: success & error\r\n  const ctxRef = useRef<AudioContext | null>(null);\r\n  const getCtx = () => (ctxRef.current ??= new (window.AudioContext || (window as any).webkitAudioContext)());\r\n  const play = (freq = 880, durMs = 120, type: OscillatorType = 'sine', gain = 0.04) => {\r\n    const ctx = getCtx();\r\n    const osc = ctx.createOscillator();\r\n    const g = ctx.createGain();\r\n    osc.type = type;\r\n    osc.frequency.value = freq;\r\n    g.gain.value = gain;\r\n    osc.connect(g); g.connect(ctx.destination);\r\n    const t = ctx.currentTime;\r\n    osc.start(t);\r\n    osc.stop(t + durMs / 1000);\r\n  };\r\n  return {\r\n    ok: () => { play(1046, 90, 'triangle', 0.05); setTimeout(()=>play(1318, 110, 'triangle', 0.05), 60); },\r\n    err: () => { play(220, 140, 'sawtooth', 0.06); setTimeout(()=>play(196, 160, 'sawtooth', 0.06), 70); }\r\n  };\r\n}\r\n\r\nexport default function ScanKiosk() {\r\n  const router = useRouter();\r\n  const [last, setLast] = useState<string>('');\r\n  const [status, setStatus] = useState<{ kind:'idle'|'ok'|'err'; text:string }>({ kind:'idle', text:'' });\r\n\r\n  const guardRef = useRef({ lastAt: 0, lastTag: '' });\r\n  const beeps = useBeep();\r\n\r\n  useScanner(async (rawTag) => {\r\n    const tag = String(rawTag || '').trim();\r\n    const now = Date.now();\r\n    // Debounce: ignore events within 250ms; also ignore immediate duplicate within 1000ms\r\n    if (now - guardRef.current.lastAt < 250) return;\r\n    if (tag === guardRef.current.lastTag && now - guardRef.current.lastAt < 1000) return;\r\n    guardRef.current = { lastAt: now, lastTag: tag };\r\n\r\n    setLast(tag);\r\n    setStatus({ kind:'idle', text:'' });\r\n\r\n    try {\r\n      const res = await progress(tag);\r\n      if (!res?.ok) throw new Error(res?.error || 'Could not progress');\r\n\r\n      if (res.nextStatus === 'Processing') {\r\n        setStatus({ kind:'ok', text:'Processing — opening butcher view…' });\r\n        beeps.ok();\r\n        router.push(`/butcher/intake?tag=${encodeURIComponent(tag)}`);\r\n      } else if (res.nextStatus === 'Finished') {\r\n        setStatus({ kind:'ok', text:'Marked Finished ✓' });\r\n        beeps.ok();\r\n        // Keep kiosk ready for the next scan\r\n        setTimeout(() => setStatus({ kind:'idle', text:'' }), 1000);\r\n      } else {\r\n        setStatus({ kind:'err', text:'No status change' });\r\n        beeps.err();\r\n        setTimeout(() => setStatus({ kind:'idle', text:'' }), 1000);\r\n      }\r\n    } catch (e: any) {\r\n      setStatus({ kind:'err', text: e?.message || 'Scan failed' });\r\n      beeps.err();\r\n    }\r\n  });\r\n\r\n  return (\r\n    <main className=\"page-wrap\" style={{ textAlign:'center' }}>\r\n      <h1 style={{ margin:'4px 0 8px' }}>Scan a Tag</h1>\r\n      <p style={{ color:'var(--muted)', margin:'0 0 16px' }}>\r\n        Scan once to start Processing; scan again to mark Finished.\r\n      </p>\r\n\r\n      <div style={{ fontSize:56, fontWeight:900, letterSpacing:1, margin:'14px 0' }}>{last || '—'}</div>\r\n\r\n      {/* Big, color banner */}\r\n      <div\r\n        aria-live=\"polite\"\r\n        style={{\r\n          minHeight: 52,\r\n          display:'grid',\r\n          placeItems:'center',\r\n          fontWeight:800,\r\n          border:'1px solid var(--border)',\r\n          borderRadius:12,\r\n          margin:'10px auto 0',\r\n          maxWidth: 680,\r\n          padding:'10px 12px',\r\n          background:\r\n            status.kind === 'ok' ? '#ecfdf5' :\r\n            status.kind === 'err' ? '#fef2f2' : 'rgba(255,255,255,0.9)',\r\n          color:\r\n            status.kind === 'ok' ? '#065f46' :\r\n            status.kind === 'err' ? '#991b1b' : 'var(--muted)'\r\n        }}\r\n      >\r\n        {status.text || 'Ready for next scan'}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}